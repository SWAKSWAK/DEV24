<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dev24.client.cart.dao.CartDAO">

	<!-- 장바구니 전체 조회 -->
	<select id="cartList" parameterType="cart" resultType="cart">
		select crt_num, b_num, b_name, b_price, crt_qty, crt_price, listcover_imgurl, cateone_num
		from cart_view
	</select>
	
	<!-- 장바구니 수량 변경 -->
	<update id="cartUpdate" parameterType="int">
		<selectKey keyProperty="b_price" resultType="int" order="BEFORE">
			select b_price from cart_view where crt_num = #{crt_num}
		</selectKey>
		
		update cart set crt_qty = #{crt_qty}, crt_price = #{b_price} * #{crt_qty}
		where crt_num = #{crt_num}
	</update>
	
	
	<!-- 장바구니 상품 삭제 -->
	<delete id="cartDelete" parameterType="int">
		delete from cart where crt_num = #{crt_num}
	</delete>
	
	<!-- 장바구니 삽입 (해당 b_num이 존재하면 update로 처리) -->
	<!-- open: 쿼리문이 시작하기 전 추가될 문자 -->
	<!-- close: 쿼리문이 끝난 후 추가될 문자 -->
	<insert id="addToCart" parameterType="java.util.List">
		insert into cart (
			crt_num, crt_price, crt_qty, b_num, c_num) 
		select crt_num_seq.nextval, c.* from (
		<foreach collection="list" item="cvo" separator="union all"> 
		select
			#{cvo.crt_price} crt_price, #{cvo.crt_qty} crt_qty, #{cvo.b_num} b_num, #{cvo.c_num} c_num
		from dual
		</foreach>) c
	</insert>

</mapper>